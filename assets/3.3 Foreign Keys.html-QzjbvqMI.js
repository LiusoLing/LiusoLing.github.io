import{_ as s}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as n,c as a,f as e}from"./app-6o-IiJuU.js";const p={},t=e(`<p>假设一种情况：您希望确保没有人可以在 weather 表中插入在 cities 表中没有匹配条目的行。</p><p>这称为维护数据的引用完整性。在简单的数据库系统中，这将通过首先查看 cities 表以检查是否存在匹配的记录，然后插入或拒绝新的 weather 记录来实现（如果有的话）。</p><p>这种方法有很多问题，而且非常不方便，所以 PostgreSQL 的 <code>外键</code> 可以帮你做这个。</p><p>让我们重新声明表：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> cities <span class="token punctuation">(</span>
        name     <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
        location <span class="token keyword">point</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> weather <span class="token punctuation">(</span>
        city      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span> <span class="token keyword">references</span> cities<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
        temp_lo   <span class="token keyword">int</span><span class="token punctuation">,</span>
        temp_hi   <span class="token keyword">int</span><span class="token punctuation">,</span>
        prcp      <span class="token keyword">real</span><span class="token punctuation">,</span>
        <span class="token keyword">date</span>      <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在尝试插入无效记录：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> weather <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;Berkeley&#39;</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token string">&#39;1994-11-28&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>ERROR:  <span class="token keyword">insert</span> <span class="token operator">or</span> <span class="token keyword">update</span> <span class="token keyword">on</span> <span class="token keyword">table</span> <span class="token string">&quot;weather&quot;</span> violates <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token keyword">constraint</span> <span class="token string">&quot;weather_city_fkey&quot;</span>
DETAIL:  <span class="token keyword">Key</span> <span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>Berkeley<span class="token punctuation">)</span> <span class="token operator">is</span> <span class="token operator">not</span> present <span class="token operator">in</span> <span class="token keyword">table</span> <span class="token string">&quot;cities&quot;</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的使用外键将有效提高应用程序的质量，我们需要了解它。</p>`,9),o=[t];function c(l,i){return n(),a("div",null,o)}const u=s(p,[["render",c],["__file","3.3 Foreign Keys.html.vue"]]);export{u as default};
